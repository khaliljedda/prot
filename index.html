<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>prot.tn - Protein House</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
            color: #333;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            padding: 0 20px;
            box-sizing: border-box;
            overflow: visible;
        }

        header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        header h1 {
            font-size: 2.5em;
            font-weight: 300;
            letter-spacing: 4px;
            text-transform: uppercase;
            margin: 0;
        }

        header p {
            display: none;
        }

        .language-selector {
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .lang-btn:hover {
            border-color: #000;
            transform: translateY(-2px);
        }

        .lang-btn.active {
            background: #000;
            color: white;
            border-color: #000;
        }

        .basket-header-icon {
            background: #000;
            color: white;
            padding: 8px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2em;
            font-weight: 700;
        }

        .basket-header-icon:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .basket-badge {
            background: white;
            color: #000;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 700;
            min-width: 20px;
            text-align: center;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* 2-Column Layout: 70% Left / 30% Right */
        .page-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
            align-items: start;
        }

        @media (max-width: 1200px) {
            .page-layout {
                grid-template-columns: 1fr;
            }
        }

        .main-content {
            width: 100%;
        }

        .builder-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .meal-summary {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: sticky;
            position: -webkit-sticky; /* Safari support */
            top: 20px;
            height: fit-content;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #ccc white;
            z-index: 10;
            transition: box-shadow 0.3s ease;
        }

        /* Enhanced shadow when scrolling */
        .meal-summary.is-stuck {
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .meal-summary h2 {
            font-size: 1.3em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
            text-align: center;
            color: #000;
        }

        .meal-summary::-webkit-scrollbar {
            width: 8px;
        }

        .meal-summary::-webkit-scrollbar-track {
            background: white;
            border-radius: 10px;
        }

        .meal-summary::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 10px;
        }

        .meal-summary::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        .meal-ingredients-list {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            max-height: 250px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #ccc #f8f9fa;
        }

        .meal-ingredients-list::-webkit-scrollbar {
            width: 6px;
        }

        .meal-ingredients-list::-webkit-scrollbar-track {
            background: #f8f9fa;
            border-radius: 10px;
        }

        .meal-ingredients-list::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 10px;
        }

        .meal-ingredients-list::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        .meal-ingredients-list h3 {
            font-size: 0.95em;
            margin-bottom: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .meal-ingredient-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #e0e0e0;
            transition: all 0.2s ease;
        }

        .meal-ingredient-item:hover {
            border-color: #000;
            transform: translateX(2px);
        }

        .meal-ingredient-item img {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            object-fit: cover;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .meal-ingredient-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .meal-ingredient-name {
            font-weight: 600;
            font-size: 0.95em;
            color: #333;
        }

        .meal-ingredient-details {
            font-size: 0.85em;
            color: #666;
        }

        .meal-ingredient-quantity {
            font-weight: 700;
            font-size: 1.1em;
            color: #000;
            min-width: 30px;
            text-align: center;
        }

        .empty-meal-list {
            text-align: center;
            padding: 30px 20px;
            color: #999;
        }

        .empty-meal-list-icon {
            font-size: 3em;
            margin-bottom: 10px;
            opacity: 0.3;
        }

        @keyframes popIn {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            60% {
                transform: scale(1.15) rotate(10deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .empty-meal-placeholder {
            font-size: 3em;
            color: #ccc;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.2));
        }

        .empty-state-message {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .empty-state-message h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .empty-state-message p {
            font-size: 0.9em;
            line-height: 1.6;
        }

        .meal-items-count {
            display: none;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .progress-bars {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .progress-item {
            margin-bottom: 15px;
        }

        .progress-item:last-child {
            margin-bottom: 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .progress-bar-container {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.4s ease, background 0.4s ease;
            position: relative;
        }

        .progress-bar-fill.protein-bar {
            background: linear-gradient(90deg, #333, #1a1a1a);
        }

        .progress-bar-fill.calorie-bar {
            background: linear-gradient(90deg, #666, #333);
        }

        .progress-bar-fill.weight-bar {
            background: linear-gradient(90deg, #999, #666);
        }

        .mobile-sticky-bar {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px 15px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom));
            box-shadow: 0 -5px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            border-top: 2px solid #e0e0e0;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }

        .mobile-sticky-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            max-width: 600px;
            margin: 0 auto;
        }

        .mobile-price {
            font-size: 1.4em;
            font-weight: bold;
            line-height: 1.2;
        }

        .mobile-protein {
            font-size: 0.85em;
            color: #666;
            line-height: 1.3;
        }

        .mobile-protein strong {
            color: #000;
            font-size: 1.1em;
        }

        .mobile-cta {
            padding: 12px 18px;
            background: #000;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            font-size: 0.95em;
            min-width: 100px;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .mobile-cta:active {
            background: #333;
            transform: scale(0.98);
        }

        .price-display {
            background: #000;
            padding: 25px 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .price-display .label {
            font-size: 0.9em;
            color: #fff;
            margin-bottom: 8px;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .price-display .value {
            font-size: 3.5em;
            font-weight: 700;
            color: white;
            line-height: 1;
        }

        .macro-highlights {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .macro-card {
            background: #fff;
            border: 2px solid #e0e0e0;
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            color: #333;
            transition: all 0.3s ease;
        }

        .macro-card.protein {
            background: #fafafa;
            border-color: #000;
        }

        .macro-card.calories {
            background: #fafafa;
            border-color: #000;
        }

        .macro-card .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .macro-card .value {
            font-size: 2.3em;
            font-weight: bold;
            color: #000;
        }

        .other-macros {
            background: #fff;
            border: 2px solid #e0e0e0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .other-macros h3 {
            font-size: 0.9em;
            color: #000;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .macro-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .macro-row:last-child {
            border-bottom: none;
        }

        .meal-quantity {
            display: none;
        }

        .meal-quantity label {
            display: none;
        }

        .meal-quantity-controls {
            display: none;
        }

        .meal-quantity-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #000;
            border-radius: 50%;
            background: #fff;
            color: #000;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .meal-quantity-btn:hover {
            background: #000;
            color: #fff;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .meal-quantity-btn:active {
            transform: scale(0.95);
        }

        .meal-quantity-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            background: #fff;
            color: #000;
        }

        .meal-quantity-btn.add-feedback {
            animation: addGlow 0.4s ease;
        }

        .meal-quantity-display {
            font-size: 1.5em;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
            color: #000;
            background: #fff;
            padding: 5px 10px;
            border-radius: 8px;
        }

        .cart-section {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            margin-bottom: 0;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: #ccc white;
        }

        .cart-section::-webkit-scrollbar {
            width: 6px;
        }

        .cart-section::-webkit-scrollbar-track {
            background: white;
            border-radius: 10px;
        }

        .cart-section::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 10px;
        }

        .cart-section::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        .current-order-section {
            padding-bottom: 20px;
            margin-bottom: 0;
        }

        .section-divider {
            height: 2px;
            background: linear-gradient(to right, transparent, #e0e0e0, transparent);
            margin: 30px 0;
            border-radius: 2px;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .cart-header h3 {
            font-size: 1.3em;
            font-weight: 700;
            color: #000;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cart-badge {
            background: #000;
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: bold;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 12px;
            border: 1px solid #e0e0e0;
            transition: all 0.2s ease;
        }

        .cart-item:hover {
            border-color: #000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .cart-item-info {
            flex: 1;
            margin-right: 15px;
        }

        .cart-item-name {
            font-weight: 600;
            color: #000;
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .cart-item-details {
            font-size: 0.85em;
            color: #666;
            line-height: 1.5;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-item-price {
            font-weight: bold;
            color: #000;
            min-width: 80px;
            text-align: right;
            font-size: 1.1em;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #000;
            color: white;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .empty-cart {
            text-align: center;
            padding: 30px;
            color: #999;
        }

        .cart-remove-btn {
            background: #666;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 6px 12px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cart-remove-btn:hover {
            background: #333;
        }

        .action-buttons {
            display: grid;
            gap: 10px;
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #000;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #1a1a1a;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #fff;
            color: #000;
            border: 2px solid #000;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #000;
            color: white;
            transform: translateY(-2px);
        }

        .btn-clear {
            background: #fff;
            color: #666;
            border: 2px solid #e0e0e0;
            font-size: 0.9em;
            padding: 10px;
        }

        .btn-clear:hover {
            background: #fff;
            color: #000;
            border-color: #000;
        }


        /* Hero Section - Rich Media Quick Select Cards */
        .quick-meals-section {
            margin-bottom: 20px;
        }

        .quick-meals-section h2 {
            font-size: 1.2em;
            margin-bottom: 12px;
            color: #666;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .quick-meals-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .quick-meal-card {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .quick-meal-card:hover {
            border-color: #000;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .quick-meal-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }

        .quick-meal-content {
            padding: 12px;
        }

        .quick-meal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .quick-meal-card h3 {
            font-size: 0.95em;
            color: #000;
            font-weight: 600;
            margin: 0;
        }

        .quick-meal-price {
            font-size: 1.1em;
            font-weight: 700;
            color: #000;
        }

        .quick-meal-card .meal-description {
            font-size: 0.75em;
            color: #666;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .quick-meal-card .meal-nutrition {
            font-size: 0.7em;
            color: #666;
            margin-bottom: 10px;
            display: flex;
            gap: 10px;
        }

        .quick-meal-card .meal-nutrition strong {
            color: #000;
        }

        .ingredients-section h2 {
            font-size: 1.8em;
            margin-bottom: 25px;
            color: #000;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .ingredient-category {
            margin-bottom: 30px;
        }

        .category-title {
            font-size: 1.3em;
            color: #000;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ingredient-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        @media (max-width: 900px) {
            .ingredient-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .ingredient-card {
            background: #fff;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .ingredient-card:hover {
            border-color: #000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .ingredient-card.highlight {
            animation: highlightPulse 0.6s ease 3;
            border-color: #000 !important;
        }

        @keyframes highlightPulse {
            0%, 100% {
                background: #fff;
                transform: scale(1);
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            }
            50% {
                background: #f5f5f5;
                transform: scale(1.03);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            }
        }

        .ingredient-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            display: block;
        }

        .ingredient-header {
            padding: 15px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 10px;
        }

        .ingredient-title-section {
            flex: 1;
        }

        .ingredient-icon {
            font-size: 3.5em;
        }

        .ingredient-name {
            font-weight: 600;
            font-size: 1.2em;
            color: #000;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .ingredient-unit {
            font-size: 0.9em;
            color: #666;
        }

        .ingredient-price-badge {
            display: none;
            background: #000;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            white-space: nowrap;
        }

        .info-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #f0f0f0;
            border: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            color: #666;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .info-icon:hover {
            background: #000;
            color: #fff;
            border-color: #000;
        }

        .ingredient-nutrition {
            background: #fff;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
            line-height: 1.8;
            color: #333;
        }

        .ingredient-nutrition-compact {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 15px;
            font-size: 0.85em;
        }

        .ingredient-nutrition-compact.show {
            display: grid;
        }

        .nutrition-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nutrition-item strong {
            font-weight: 600;
            color: #000;
        }

        .info-toggle {
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .info-toggle:hover {
            background: #000;
            color: #fff;
        }

        .full-nutrition {
            display: none;
            font-size: 0.8em;
            color: #666;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .full-nutrition.show {
            display: block;
        }

        .ingredient-card-footer {
            padding: 15px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .ingredient-price-display {
            font-size: 1.3em;
            font-weight: bold;
            color: #000;
        }

        .ingredient-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Modern Control Buttons */
        .control-btn {
            width: 42px;
            height: 42px;
            border: 2px solid #000;
            border-radius: 50%;
            background: #fff;
            color: #000;
            font-size: 1.4em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .control-btn:hover {
            background: #000;
            color: #fff;
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        /* Compact mobile controls */
        .ingredient-controls-compact {
            display: none;
            width: 100%;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 10px;
            align-items: center;
            justify-content: space-between;
        }

        .controls-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .compact-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            background: #000;
            color: #fff;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        .compact-btn:active {
            transform: scale(0.9);
        }

        .compact-btn.remove-btn {
            background: #666;
        }

        .compact-btn.add-btn {
            background: #000;
        }

        .quantity-badge {
            font-size: 1.1em;
            font-weight: bold;
            color: #000;
            min-width: 30px;
            text-align: center;
            background: #fff;
            padding: 6px 12px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .control-btn.add-feedback {
            animation: addGlow 0.4s ease;
        }

        .control-btn.remove-feedback {
            animation: removeGlow 0.4s ease;
        }

        @keyframes addGlow {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
            50% {
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
                background: #000;
                color: white;
                border-color: #000;
            }
        }

        @keyframes removeGlow {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
            50% {
                box-shadow: 0 0 20px rgba(102, 102, 102, 0.8);
                background: #666;
                color: white;
                border-color: #666;
            }
        }

        .quantity-display {
            font-size: 1.5em;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
            color: #000;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 8px;
        }

        .quantity-input {
            width: 50px;
            padding: 5px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
        }

        .ingredient-price {
            font-size: 1.1em;
            color: #fff;
            font-weight: 700;
            margin-top: 8px;
            text-align: center;
            background: #000;
            padding: 8px 12px;
            border-radius: 8px;
        }

        .free-item {
            background: #fff;
            border: 2px solid #e0e0e0;
            padding: 20px;
            border-radius: 10px;
            color: #333;
            margin-top: 20px;
            text-align: center;
        }

        .free-item h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #000;
        }

        .free-item p {
            font-size: 0.95em;
            color: #666;
            line-height: 1.6;
        }

        /* Tablet and smaller desktop */
        @media (max-width: 1200px) {
            .page-layout {
                grid-template-columns: 1fr;
            }

            .meal-summary {
                position: relative !important;
                top: 0 !important;
                max-height: none !important;
                order: -1;
                margin-bottom: 20px;
            }

            .quick-meals-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            header {
                flex-direction: column;
                gap: 15px;
            }

            .header-right {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* Tablet */
        @media (max-width: 1024px) and (min-width: 769px) {
            body {
                padding: 15px;
            }

            .ingredient-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }

            .quick-meals-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .ingredient-image {
                height: 140px;
            }

            .ingredient-header {
                padding: 10px;
            }

            .ingredient-price-badge {
                display: block;
                font-size: 0.9em;
                padding: 5px 10px;
            }

            .ingredient-name {
                font-size: 0.95em;
            }

            .ingredient-controls-compact {
                display: flex;
                padding: 8px;
                margin: 0 8px 8px 8px;
            }

            .ingredient-card-footer {
                display: none;
            }

            .compact-btn {
                width: 34px;
                height: 34px;
                font-size: 1.2em;
            }

            .quantity-badge {
                font-size: 1.05em;
            }
        }

        /* Mobile */
        @media (max-width: 768px) {
            body {
                padding: 8px;
                padding-bottom: calc(90px + env(safe-area-inset-bottom));
            }

            header {
                padding: 10px 8px;
                margin-bottom: 12px;
            }

            header h1 {
                font-size: 1.4em;
                letter-spacing: 2px;
                margin-bottom: 8px;
            }

            .language-selector {
                position: relative;
                margin: 0 auto 12px;
                flex-wrap: wrap;
                gap: 6px;
                padding: 8px 12px;
            }

            .lang-btn {
                padding: 6px 12px;
                font-size: 0.85em;
                min-width: 55px;
            }

            .builder-section {
                padding: 15px;
            }

            .meals-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .quick-meals-section {
                margin-bottom: 15px;
            }

            .quick-meals-section h2 {
                font-size: 1em;
                margin-bottom: 10px;
                color: #666;
            }

            .quick-meals-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .quick-meal-image {
                height: 120px;
            }

            .quick-meal-content {
                padding: 10px;
            }

            .quick-meal-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .quick-meal-card h3 {
                font-size: 0.9em;
            }

            .quick-meal-price {
                font-size: 1em;
            }

            .quick-meal-card {
                padding: 10px;
            }

            .quick-meal-card h3 {
                font-size: 0.9em;
                margin-bottom: 6px;
            }

            .quick-meal-card .meal-description {
                font-size: 0.7em;
                margin-bottom: 8px;
            }

            .quick-meal-card .meal-nutrition {
                font-size: 0.65em;
                padding-top: 8px;
            }

            .ingredients-section h2 {
                font-size: 1.3em;
                margin-bottom: 15px;
            }

            .ingredient-category {
                margin-bottom: 20px;
                padding: 15px;
            }

            .category-title {
                font-size: 1.1em;
                margin-bottom: 12px;
                padding-bottom: 10px;
            }

            .macro-highlights {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }

            .macro-card {
                padding: 12px;
            }

            .macro-card .label {
                font-size: 0.8em;
                margin-bottom: 5px;
            }

            .macro-card .value {
                font-size: 1.8em;
            }

            /* KEY CHANGE: Show 2 ingredients per row on mobile */
            .ingredient-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .ingredient-card {
                margin-bottom: 0;
            }

            /* Reduce image height to fit more on screen */
            .ingredient-image {
                height: 100px;
            }

            .ingredient-header {
                padding: 8px;
                flex-direction: column;
                align-items: stretch;
                gap: 6px;
            }

            .ingredient-title-section {
                order: 2;
            }

            .ingredient-price-badge {
                display: block;
                order: 1;
                text-align: center;
                font-size: 0.85em;
                padding: 4px 8px;
            }

            .ingredient-name {
                font-size: 0.8em;
                margin-bottom: 2px;
            }

            .ingredient-unit {
                font-size: 0.7em;
            }

            .info-icon {
                width: 18px;
                height: 18px;
                font-size: 0.75em;
            }

            .ingredient-nutrition-compact {
                padding: 8px;
                font-size: 0.75em;
                gap: 6px;
                margin: 8px 10px;
            }

            /* Mobile: Hide desktop footer, show compact controls */
            .ingredient-card-footer {
                display: none;
            }

            .ingredient-controls-compact {
                display: flex;
                padding: 8px;
                margin: 0 8px 8px 8px;
            }

            .compact-btn {
                width: 32px;
                height: 32px;
                font-size: 1.2em;
            }

            .quantity-badge {
                font-size: 1em;
                padding: 4px 10px;
            }

            .ingredient-content {
                padding: 10px;
            }

            .meal-photo-container {
                min-height: 120px;
                padding: 12px;
            }

            .meal-photo {
                width: 150px;
                height: 150px;
                padding: 15px;
            }

            .meal-ingredient-icon {
                font-size: 1.8em;
            }

            .control-btn {
                width: 40px;
                height: 40px;
                font-size: 1.3em;
                min-width: 40px;
                min-height: 40px;
            }

            .quantity-display {
                font-size: 1.2em;
                min-width: 30px;
                padding: 3px 8px;
            }

            .meal-summary {
                padding: 15px;
                margin-bottom: 15px;
            }

            .meal-summary h2 {
                font-size: 1.2em;
                margin-bottom: 12px;
            }

            .price-display {
                padding: 12px;
                margin-bottom: 15px;
            }

            .price-display .label {
                font-size: 0.9em;
                margin-bottom: 3px;
            }

            .price-display .value {
                font-size: 2.2em;
            }

            .other-macros {
                padding: 12px;
                margin-bottom: 15px;
            }

            .other-macros h3 {
                font-size: 0.85em;
                margin-bottom: 8px;
            }

            .macro-row {
                padding: 6px 0;
                font-size: 0.9em;
            }

            .meal-items-count {
                padding: 12px;
                margin-bottom: 15px;
                font-size: 0.85em;
            }

            .meal-quantity {
                padding: 12px;
                margin-bottom: 15px;
            }

            .meal-quantity label {
                font-size: 0.95em;
                margin-bottom: 12px;
            }

            .meal-quantity-controls {
                padding: 12px;
            }

            .meal-quantity-btn {
                width: 45px;
                height: 45px;
                font-size: 1.6em;
            }

            .meal-quantity-display {
                font-size: 2em;
                padding: 8px 15px;
            }

            .quantity-controls {
                gap: 12px;
            }

            .quantity-btn {
                width: 38px;
                height: 38px;
                font-size: 1.2em;
            }

            #mealCount {
                font-size: 1.1em;
                width: 55px;
                padding: 6px;
            }

            .action-buttons {
                flex-direction: column;
                gap: 8px;
            }

            .btn {
                padding: 12px 18px;
                font-size: 0.95em;
                width: 100%;
            }

            .category-section {
                margin-bottom: 20px;
            }

            .category-header {
                font-size: 1.1em;
                padding: 10px 12px;
                margin-bottom: 12px;
            }

            .mobile-sticky-bar {
                display: block;
            }

            .modal-content {
                width: 90%;
                max-width: 90%;
                padding: 20px 15px;
                margin: 15px;
                max-height: 90vh;
                overflow-y: auto;
            }

            .modal-content h2 {
                font-size: 1.2em;
                margin-bottom: 12px;
            }

            .form-group {
                margin-bottom: 12px;
            }

            .form-group label {
                font-size: 0.9em;
            }

            .form-group input {
                padding: 10px;
                font-size: 0.95em;
            }

            .cart-section {
                margin-bottom: 15px;
                padding: 15px;
                max-height: 350px;
            }

            .cart-item {
                padding: 10px;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
                margin-bottom: 8px;
            }

            .cart-item-info {
                width: 100%;
            }

            .cart-item-name {
                font-size: 0.9em;
                margin-bottom: 3px;
            }

            .cart-item-details {
                font-size: 0.75em;
            }

            .cart-item-controls {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }

            .cart-item-price {
                font-size: 1em;
            }

            .cart-remove-btn {
                padding: 5px 10px;
                font-size: 0.85em;
            }

            .cart-total {
                padding: 12px;
                font-size: 1em;
            }

            .cart-total h3 {
                font-size: 1.1em;
            }

            .cart-total-price {
                font-size: 1.3em;
            }
        }

        /* Small mobile */
        @media (max-width: 480px) {
            body {
                padding: 6px;
                padding-bottom: calc(85px + env(safe-area-inset-bottom));
            }

            header {
                padding: 8px 6px;
            }

            header h1 {
                font-size: 1.2em;
                letter-spacing: 1px;
                margin-bottom: 6px;
            }

            header p {
                font-size: 0.9em;
            }

            .language-selector {
                padding: 6px 10px;
                gap: 5px;
            }

            .lang-btn {
                padding: 5px 8px;
                font-size: 0.75em;
                min-width: 45px;
            }

            .builder-section {
                padding: 12px;
            }

            .quick-meals-section h2 {
                font-size: 0.95em;
                margin-bottom: 8px;
                color: #666;
            }

            .quick-meal-card {
                padding: 8px;
            }

            .quick-meal-card h3 {
                font-size: 0.85em;
                margin-bottom: 5px;
            }

            .quick-meal-card .meal-description {
                font-size: 0.65em;
                margin-bottom: 6px;
            }

            .quick-meal-card .meal-nutrition {
                font-size: 0.6em;
                padding-top: 6px;
            }

            .ingredients-section h2 {
                font-size: 1.15em;
                margin-bottom: 12px;
            }

            .ingredient-category {
                padding: 12px;
                margin-bottom: 15px;
            }

            .category-title {
                font-size: 1em;
                margin-bottom: 10px;
                padding-bottom: 8px;
            }

            /* Keep 2 columns even on small mobile */
            .ingredient-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .ingredient-image {
                height: 90px;
            }

            .ingredient-header {
                padding: 6px;
            }

            .ingredient-price-badge {
                font-size: 0.8em;
                padding: 3px 6px;
            }

            .ingredient-name {
                font-size: 0.75em;
                margin-bottom: 2px;
            }

            .ingredient-unit {
                font-size: 0.65em;
            }

            .info-icon {
                width: 16px;
                height: 16px;
                font-size: 0.7em;
            }

            .ingredient-nutrition-compact {
                padding: 6px;
                font-size: 0.7em;
                gap: 5px;
                margin: 6px 8px;
            }

            .ingredient-controls-compact {
                padding: 6px;
                margin: 0 6px 6px 6px;
            }

            .compact-btn {
                width: 30px;
                height: 30px;
                font-size: 1.1em;
            }

            .quantity-badge {
                font-size: 0.95em;
                padding: 3px 8px;
            }

            .control-btn {
                width: 36px;
                height: 36px;
                font-size: 1.2em;
                min-width: 36px;
                min-height: 36px;
            }

            .quantity-display {
                font-size: 1.1em;
                min-width: 28px;
                padding: 2px 6px;
            }

            .meal-photo-container {
                min-height: 100px;
                padding: 10px;
            }

            .meal-photo {
                width: 130px;
                height: 130px;
                padding: 12px;
            }

            .meal-ingredient-icon {
                font-size: 1.5em;
            }

            .meal-summary {
                padding: 12px;
            }

            .price-display {
                padding: 10px;
                margin-bottom: 12px;
            }

            .price-display .label {
                font-size: 0.85em;
            }

            .price-display .value {
                font-size: 1.9em;
            }

            .macro-highlights {
                gap: 6px;
            }

            .macro-card {
                padding: 10px;
            }

            .macro-card .label {
                font-size: 0.75em;
            }

            .macro-card .value {
                font-size: 1.6em;
            }

            .other-macros {
                padding: 10px;
                margin-bottom: 12px;
            }

            .other-macros h3 {
                font-size: 0.8em;
                margin-bottom: 6px;
            }

            .macro-row {
                padding: 5px 0;
                font-size: 0.85em;
            }

            .meal-items-count {
                padding: 10px;
                margin-bottom: 12px;
                font-size: 0.8em;
            }

            .meal-quantity {
                padding: 10px;
                margin-bottom: 12px;
            }

            .meal-quantity label {
                font-size: 0.9em;
                margin-bottom: 10px;
            }

            .meal-quantity-controls {
                padding: 10px;
                gap: 15px;
            }

            .meal-quantity-btn {
                width: 42px;
                height: 42px;
                font-size: 1.5em;
            }

            .meal-quantity-display {
                font-size: 1.8em;
                padding: 6px 12px;
            }

            .cart-section {
                padding: 12px;
                margin-bottom: 12px;
            }

            .cart-header h3 {
                font-size: 1em;
            }

            .cart-badge {
                width: 24px;
                height: 24px;
                font-size: 0.8em;
            }

            .btn {
                padding: 11px 16px;
                font-size: 0.9em;
            }

            .modal-content {
                padding: 15px 12px;
            }

            .modal-content h2 {
                font-size: 1.1em;
            }

            .mobile-sticky-bar {
                padding: 10px 12px;
            }

            .mobile-price {
                font-size: 1.3em;
            }

            .mobile-protein {
                font-size: 0.8em;
            }

            .mobile-cta {
                padding: 10px 15px;
                font-size: 0.9em;
                min-width: 90px;
            }
        }

        /* Landscape mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .meal-photo {
                width: 120px;
                height: 120px;
            }

            .meal-photo-container {
                min-height: 100px;
                padding: 10px;
            }

            /* Show 3 columns in landscape for better space usage */
            .ingredient-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }

            .ingredient-image {
                height: 90px;
            }

            .ingredient-name {
                font-size: 0.8em;
            }

            .control-btn {
                width: 36px;
                height: 36px;
                font-size: 1.2em;
            }

            .ingredient-price-display {
                font-size: 0.85em;
            }

            .quick-meals-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .control-btn,
            .btn,
            .quantity-btn,
            .lang-btn,
            .quick-meal-card,
            .meal-quantity-btn {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            }

            .ingredient-card:hover {
                transform: none;
            }

            .ingredient-card:active {
                transform: scale(0.98);
                transition: transform 0.1s ease;
            }

            .control-btn:active {
                transform: scale(0.9);
            }

            .quick-meal-card:active {
                transform: translateY(-2px);
                transition: transform 0.1s ease;
            }

            /* Better touch targets on mobile */
            .control-btn {
                min-width: 44px;
                min-height: 44px;
            }

            /* Smooth scrolling on iOS */
            body {
                -webkit-overflow-scrolling: touch;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .modal-content p {
            margin-bottom: 30px;
            color: #666;
            line-height: 1.6;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: #000;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            text-align: center;
            max-width: 90%;
            font-size: 0.95em;
            line-height: 1.4;
        }

        .toast.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .toast {
                bottom: 110px;
                padding: 12px 20px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>prot.tn</h1>
            <div class="header-right">
                <div class="language-selector">
                    <button class="lang-btn" onclick="changeLanguage('en')" id="lang-en"> EN</button>
                    <button class="lang-btn" onclick="changeLanguage('fr')" id="lang-fr"> FR</button>
                    <button class="lang-btn active" onclick="changeLanguage('ar')" id="lang-ar"> AR</button>
                </div>
                <div class="basket-header-icon" onclick="goToBasket()">
                    
                    <span class="basket-badge" id="headerBasketCount">0</span>
                </div>
            </div>
        </header>

        <div class="page-layout">
            <div class="main-content">
                <div class="builder-section">
                <div class="quick-meals-section">
                    <h2 data-translate="quickMeals"> Quick Select Meals</h2>
                    <div class="quick-meals-grid">
                        <div class="quick-meal-card" onclick="selectQuickMeal('scalope')">
                            <img src="plat-scaloppe.png" alt="Escalope Meal" class="quick-meal-image">
                            <div class="quick-meal-content">
                                <div class="quick-meal-header">
                                    <h3 data-translate="mealScalope">Escalope Meal</h3>
                                    <div class="quick-meal-price">13.00 TND</div>
                                </div>
                                <div class="meal-description" data-translate="mealScalopeDesc">Rice + Escalope + Salad</div>
                                <div class="meal-nutrition">
                                    <span> <strong>32g</strong></span>
                                    <span> <strong>495</strong> kcal</span>
                                </div>
                            </div>
                        </div>
                        <div class="quick-meal-card" onclick="selectQuickMeal('proteinOverdose')">
                            <img src="protein-overdose.png" alt="Protein Overdose" class="quick-meal-image">
                            <div class="quick-meal-content">
                                <div class="quick-meal-header">
                                    <h3 data-translate="mealProteinOverdose">Protein Overdose</h3>
                                    <div class="quick-meal-price">16.80 TND</div>
                                </div>
                                <div class="meal-description" data-translate="mealProteinOverdoseDesc">Escalope + Cuisse + Egg + Omelette + Salad</div>
                                <div class="meal-nutrition">
                                    <span> <strong>65g</strong></span>
                                    <span> <strong>555</strong> kcal</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="ingredients-section">
                    <h2 data-translate="buildOwn"> Cook Your Own Meal</h2>

                    <div class="ingredient-category">
                        <div class="category-title" data-translate="carbs"> Carbs</div>
                        <div class="ingredient-grid">
                            <div class="ingredient-card">
                                <img src="rice.jpeg" alt="Rice" class="ingredient-image">
                                <div class="ingredient-header">
                                    <div class="ingredient-price-badge">1.50 TND</div>
                                    <div class="ingredient-title-section">
                                        <div class="ingredient-name" data-ingredient="rice">Rice <span class="info-icon" onclick="toggleNutrition(this)"></span></div>
                                        <div class="ingredient-unit">50g <span data-translate="perUnit">per unit</span></div>
                                    </div>
                                </div>
                                <div class="ingredient-nutrition-compact">
                                    <div class="nutrition-item">
                                        <span data-translate="proteinLabel">Protein</span>
                                        <strong>3g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="carbsLabel">Carbs</span>
                                        <strong>40g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="caloriesLabel">Calories</span>
                                        <strong>175</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="priceLabel">Price</span>
                                        <strong>1.50 TND</strong>
                                    </div>
                                </div>
                                <div class="ingredient-controls-compact">
                                    <div class="controls-left">
                                        <button class="compact-btn remove-btn" onclick="updateIngredient('rice', -1)"></button>
                                        <div class="quantity-badge" id="qty-mobile-rice">0</div>
                                        <button class="compact-btn add-btn" onclick="updateIngredient('rice', 1)">+</button>
                                    </div>
                                </div>
                                <div class="ingredient-card-footer">
                                    <div class="ingredient-price-display">1.50 TND</div>
                                    <div class="ingredient-controls">
                                        <button class="control-btn" onclick="updateIngredient('rice', -1)"></button>
                                        <div class="quantity-display" id="qty-rice">0</div>
                                        <button class="control-btn" onclick="updateIngredient('rice', 1)">+</button>
                                    </div>
                                </div>
                            </div>

                            <div class="ingredient-card">
                                <img src="borghol.jpg" alt="Borghol" class="ingredient-image">
                                <div class="ingredient-header">
                                    <div class="ingredient-price-badge">1.50 TND</div>
                                    <div class="ingredient-title-section">
                                        <div class="ingredient-name" data-ingredient="borghol">Borghol <span class="info-icon" onclick="toggleNutrition(this)"></span></div>
                                        <div class="ingredient-unit">50g <span data-translate="perUnit">per unit</span></div>
                                    </div>
                                </div>
                                <div class="ingredient-nutrition-compact">
                                    <div class="nutrition-item">
                                        <span data-translate="proteinLabel">Protein</span>
                                        <strong>4g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="carbsLabel">Carbs</span>
                                        <strong>38g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="caloriesLabel">Calories</span>
                                        <strong>170</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="priceLabel">Price</span>
                                        <strong>1.50 TND</strong>
                                    </div>
                                </div>
                                <div class="ingredient-controls-compact">
                                    <div class="controls-left">
                                        <button class="compact-btn remove-btn" onclick="updateIngredient('borghol', -1)"></button>
                                        <div class="quantity-badge" id="qty-mobile-borghol">0</div>
                                        <button class="compact-btn add-btn" onclick="updateIngredient('borghol', 1)">+</button>
                                    </div>
                                </div>
                                <div class="ingredient-card-footer">
                                    <div class="ingredient-price-display">1.50 TND</div>
                                    <div class="ingredient-controls">
                                        <button class="control-btn" onclick="updateIngredient('borghol', -1)"></button>
                                        <div class="quantity-display" id="qty-borghol">0</div>
                                        <button class="control-btn" onclick="updateIngredient('borghol', 1)">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="ingredient-category">
                        <div class="category-title" data-translate="proteins"> Proteins</div>
                        <div class="ingredient-grid">
                            <div class="ingredient-card">
                                <img src="escalope.jpg" alt="Escalope" class="ingredient-image">
                                <div class="ingredient-header">
                                    <div class="ingredient-price-badge">8.50 TND</div>
                                    <div class="ingredient-title-section">
                                        <div class="ingredient-name" data-ingredient="escalope">Escalope <span class="info-icon" onclick="toggleNutrition(this)"></span></div>
                                        <div class="ingredient-unit">100g <span data-translate="perUnit">per unit</span></div>
                                    </div>
                                </div>
                                <div class="ingredient-nutrition-compact">
                                    <div class="nutrition-item">
                                        <span data-translate="proteinLabel">Protein</span>
                                        <strong>25g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="carbsLabel">Carbs</span>
                                        <strong>0g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="caloriesLabel">Calories</span>
                                        <strong>120</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="priceLabel">Price</span>
                                        <strong>8.50 TND</strong>
                                    </div>
                                </div>
                                <div class="ingredient-controls-compact">
                                    <div class="controls-left">
                                        <button class="compact-btn remove-btn" onclick="updateIngredient('scallop', -1)"></button>
                                        <div class="quantity-badge" id="qty-mobile-scallop">0</div>
                                        <button class="compact-btn add-btn" onclick="updateIngredient('scallop', 1)">+</button>
                                    </div>
                                </div>
                                <div class="ingredient-card-footer">
                                    <div class="ingredient-price-display">8.50 TND</div>
                                    <div class="ingredient-controls">
                                        <button class="control-btn" onclick="updateIngredient('scallop', -1)"></button>
                                        <div class="quantity-display" id="qty-scallop">0</div>
                                        <button class="control-btn" onclick="updateIngredient('scallop', 1)">+</button>
                                    </div>
                                </div>
                            </div>

                            <div class="ingredient-card">
                                <img src="cuisse.jpeg" alt="Cuisse" class="ingredient-image">
                                <div class="ingredient-header">
                                    <div class="ingredient-price-badge">3.50 TND</div>
                                    <div class="ingredient-title-section">
                                        <div class="ingredient-name" data-ingredient="cuisse">Cuisse (Chicken Thigh) <span class="info-icon" onclick="toggleNutrition(this)"></span></div>
                                        <div class="ingredient-unit">1 <span data-translate="piece">piece</span></div>
                                    </div>
                                </div>
                                <div class="ingredient-nutrition-compact">
                                    <div class="nutrition-item">
                                        <span data-translate="proteinLabel">Protein</span>
                                        <strong>18g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="carbsLabel">Carbs</span>
                                        <strong>0g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="caloriesLabel">Calories</span>
                                        <strong>160</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="priceLabel">Price</span>
                                        <strong>3.50 TND</strong>
                                    </div>
                                </div>
                                <div class="ingredient-controls-compact">
                                    <div class="controls-left">
                                        <button class="compact-btn remove-btn" onclick="updateIngredient('cuisse', -1)"></button>
                                        <div class="quantity-badge" id="qty-mobile-cuisse">0</div>
                                        <button class="compact-btn add-btn" onclick="updateIngredient('cuisse', 1)">+</button>
                                    </div>
                                </div>
                                <div class="ingredient-card-footer">
                                    <div class="ingredient-price-display">3.50 TND</div>
                                    <div class="ingredient-controls">
                                        <button class="control-btn" onclick="updateIngredient('cuisse', -1)"></button>
                                        <div class="quantity-display" id="qty-cuisse">0</div>
                                        <button class="control-btn" onclick="updateIngredient('cuisse', 1)">+</button>
                                    </div>
                                </div>
                            </div>

                            <div class="ingredient-card">
                                <img src="egg.jpeg" alt="Eggs" class="ingredient-image">
                                <div class="ingredient-header">
                                    <div class="ingredient-price-badge">0.80 TND</div>
                                    <div class="ingredient-title-section">
                                        <div class="ingredient-name" data-ingredient="eggs">Eggs <span class="info-icon" onclick="toggleNutrition(this)"></span></div>
                                        <div class="ingredient-unit">1 <span data-translate="piece">piece</span></div>
                                    </div>
                                </div>
                                <div class="ingredient-nutrition-compact">
                                    <div class="nutrition-item">
                                        <span data-translate="proteinLabel">Protein</span>
                                        <strong>6g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="carbsLabel">Carbs</span>
                                        <strong>1g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="caloriesLabel">Calories</span>
                                        <strong>70</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="priceLabel">Price</span>
                                        <strong>0.80 TND</strong>
                                    </div>
                                </div>
                                <div class="ingredient-controls-compact">
                                    <div class="controls-left">
                                        <button class="compact-btn remove-btn" onclick="updateIngredient('eggs', -1)"></button>
                                        <div class="quantity-badge" id="qty-mobile-eggs">0</div>
                                        <button class="compact-btn add-btn" onclick="updateIngredient('eggs', 1)">+</button>
                                    </div>
                                </div>
                                <div class="ingredient-card-footer">
                                    <div class="ingredient-price-display">0.80 TND</div>
                                    <div class="ingredient-controls">
                                        <button class="control-btn" onclick="updateIngredient('eggs', -1)"></button>
                                        <div class="quantity-display" id="qty-eggs">0</div>
                                        <button class="control-btn" onclick="updateIngredient('eggs', 1)">+</button>
                                    </div>
                                </div>
                            </div>

                            <div class="ingredient-card">
                                <img src="omelette.jpeg" alt="Omelette" class="ingredient-image">
                                <div class="ingredient-header">
                                    <div class="ingredient-price-badge">2.50 TND</div>
                                    <div class="ingredient-title-section">
                                        <div class="ingredient-name" data-ingredient="omelette">Omelette <span class="info-icon" onclick="toggleNutrition(this)"></span></div>
                                        <div class="ingredient-unit">1 <span data-translate="piece">piece</span> (<span data-translate="eggs3">3 eggs</span>)</div>
                                    </div>
                                </div>
                                <div class="ingredient-nutrition-compact">
                                    <div class="nutrition-item">
                                        <span data-translate="proteinLabel">Protein</span>
                                        <strong>15g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="carbsLabel">Carbs</span>
                                        <strong>2g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="caloriesLabel">Calories</span>
                                        <strong>180</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="priceLabel">Price</span>
                                        <strong>2.50 TND</strong>
                                    </div>
                                </div>
                                <div class="ingredient-controls-compact">
                                    <div class="controls-left">
                                        <button class="compact-btn remove-btn" onclick="updateIngredient('omelette', -1)"></button>
                                        <div class="quantity-badge" id="qty-mobile-omelette">0</div>
                                        <button class="compact-btn add-btn" onclick="updateIngredient('omelette', 1)">+</button>
                                    </div>
                                </div>
                                <div class="ingredient-card-footer">
                                    <div class="ingredient-price-display">2.50 TND</div>
                                    <div class="ingredient-controls">
                                        <button class="control-btn" onclick="updateIngredient('omelette', -1)"></button>
                                        <div class="quantity-display" id="qty-omelette">0</div>
                                        <button class="control-btn" onclick="updateIngredient('omelette', 1)">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="ingredient-category">
                        <div class="category-title" data-translate="salads"> Salads</div>
                        <div class="ingredient-grid">
                            <div class="ingredient-card">
                                <img src="salade.jpg" alt="Normal Salad" class="ingredient-image">
                                <div class="ingredient-header">
                                    <div class="ingredient-price-badge">1.50 TND</div>
                                    <div class="ingredient-title-section">
                                        <div class="ingredient-name" data-ingredient="normalSalad">Normal Salad <span class="info-icon" onclick="toggleNutrition(this)"></span></div>
                                        <div class="ingredient-unit">100g <span data-translate="perPortion">per portion</span></div>
                                    </div>
                                </div>
                                <div class="ingredient-nutrition-compact">
                                    <div class="nutrition-item">
                                        <span data-translate="proteinLabel">Protein</span>
                                        <strong>1g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="carbsLabel">Carbs</span>
                                        <strong>5g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="caloriesLabel">Calories</span>
                                        <strong>25</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="priceLabel">Price</span>
                                        <strong>1.50 TND</strong>
                                    </div>
                                </div>
                                <div class="ingredient-controls-compact">
                                    <div class="controls-left">
                                        <button class="compact-btn remove-btn" onclick="updateIngredient('salad', -1)"></button>
                                        <div class="quantity-badge" id="qty-mobile-salad">0</div>
                                        <button class="compact-btn add-btn" onclick="updateIngredient('salad', 1)">+</button>
                                    </div>
                                </div>
                                <div class="ingredient-card-footer">
                                    <div class="ingredient-price-display">1.50 TND</div>
                                    <div class="ingredient-controls">
                                        <button class="control-btn" onclick="updateIngredient('salad', -1)"></button>
                                        <div class="quantity-display" id="qty-salad">0</div>
                                        <button class="control-btn" onclick="updateIngredient('salad', 1)">+</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="ingredient-category">
                        <div class="category-title"> <span data-translate="freeFruit">Free Daily Surprise Fruit</span></div>
                        <div class="ingredient-grid">
                            <div class="ingredient-card">
                                <div style="width: 100%; height: 180px; background: #f5f5f5; display: flex; align-items: center; justify-content: center; font-size: 5em;" id="surpriseFruitIcon"></div>
                                <div class="ingredient-header">
                                    <div class="ingredient-title-section">
                                        <div class="ingredient-name"><span data-translate="surpriseFruit">Surprise Fruit</span> <span class="info-icon" onclick="toggleNutrition(this)"></span></div>
                                        <div class="ingredient-unit" data-translate="dailyFree">Daily free gift</div>
                                    </div>
                                </div>
                                <div class="ingredient-nutrition-compact">
                                    <div class="nutrition-item">
                                        <span data-translate="carbsLabel">Carbs</span>
                                        <strong>15g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span data-translate="caloriesLabel">Calories</span>
                                        <strong>80</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span>Fiber</span>
                                        <strong>4g</strong>
                                    </div>
                                    <div class="nutrition-item">
                                        <span>Vitamin C</span>
                                        <strong>High</strong>
                                    </div>
                                </div>
                                <div class="ingredient-card-footer">
                                    <div class="ingredient-price-display" style="color: #000; font-weight: bold;">FREE</div>
                                    <div class="ingredient-controls" style="opacity: 0.5; pointer-events: none;">
                                        <div style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center;"></div>
                                        <div class="quantity-display" style="color: #000;">1</div>
                                        <div style="width: 42px; height: 42px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div> <!-- end main-content -->

            <div class="meal-summary">
                <div class="current-order-section">
                    <h2>Your Current Order</h2>
                    
                    <div class="meal-ingredients-list" id="mealIngredientsList">
                        <div class="empty-meal-list">
                            <div class="empty-meal-list-icon"></div>
                            <p>No ingredients added yet</p>
                        </div>
                    </div>

                    <div class="price-display">
                        <div class="label" data-translate="totalPrice">Total Price</div>
                        <div class="value"><span id="totalPrice">0.00</span> TND</div>
                    </div>

                    <div class="macro-highlights">
                        <div class="macro-card protein">
                            <div class="label" data-translate="protein"> Protein</div>
                            <div class="value"><span id="totalProtein">0</span>g</div>
                        </div>
                        <div class="macro-card calories">
                            <div class="label" data-translate="calories"> Calories</div>
                            <div class="value"><span id="totalCalories">0</span></div>
                        </div>
                    </div>

                    <div class="other-macros">
                        <h3 data-translate="nutritionalDetails">Nutritional Details</h3>
                        <div class="macro-row">
                            <span data-translate="carbohydrates">Carbohydrates</span>
                            <strong><span id="totalCarbs">0</span>g</strong>
                        </div>
                        <div class="macro-row">
                            <span data-translate="fats">Fats</span>
                            <strong><span id="totalFats">0</span>g</strong>
                        </div>
                        <div class="macro-row">
                            <span data-translate="fiber">Fiber (from fruit)</span>
                            <strong><span id="totalFiber">4</span>g</strong>
                        </div>
                    </div>

                    <div class="meal-items-count" id="itemsCount">
                        <strong>0</strong> items in your meal
                    </div>

                    <div class="meal-quantity">
                        <label data-translate="numberOfMeals">Number of Meals</label>
                        <div class="meal-quantity-controls">
                            <button class="meal-quantity-btn" onclick="changeMealCount(-1)" id="mealCountDecrease"></button>
                            <div class="meal-quantity-display" id="mealCountDisplay">1</div>
                            <button class="meal-quantity-btn" onclick="changeMealCount(1)" id="mealCountIncrease">+</button>
                        </div>
                        <input type="hidden" id="mealCount" value="1" min="1" max="7">
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" id="addToCartBtn" onclick="addToCart()" disabled data-translate="addToCart">Add to Basket</button>
                        <button class="btn btn-secondary" id="buyNowBtn" onclick="buyNow()" disabled data-translate="buyNow">Buy Now</button>
                        <button class="btn btn-clear" onclick="clearMeal()" data-translate="clearAll">Clear</button>
                    </div>
                </div>

            </div>
        </div> <!-- end page-layout -->
    </div>

    <div class="modal" id="successModal" onclick="if(event.target === this) closeModal()">
        <div class="modal-content">
            <h2> Success!</h2>
            <p id="modalMessage">Your action was successful!</p>
            <button class="btn btn-primary" onclick="closeModal()">Close</button>
        </div>
    </div>

    <div class="modal" id="customerInfoModal" onclick="if(event.target === this) closeCustomerModal()">
        <div class="modal-content">
            <h2 data-translate="customerInfo">Customer Information</h2>
            <form id="customerForm" onsubmit="submitOrder(event)">
                <div style="margin-bottom: 20px; text-align: left;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;" data-translate="yourName">Your Name</label>
                    <input type="text" id="customerName" required style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em;">
                </div>
                <div style="margin-bottom: 20px; text-align: left;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;" data-translate="yourPhone">Your Phone Number</label>
                    <input type="tel" id="customerPhone" required pattern="[0-9]{8}" maxlength="8" placeholder="12345678" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em;" oninput="validatePhone(this)" onkeypress="return /[0-9]/.test(event.key)">
                    <small id="phoneError" style="color: #666; display: none; margin-top: 5px; font-size: 0.85em;" data-translate="phoneError">Phone number must be exactly 8 digits</small>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;" data-translate="confirmOrder2">Confirm Order</button>
                    <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeCustomerModal()" data-translate="cancel">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div class="mobile-sticky-bar" id="mobileBar">
        <div class="mobile-sticky-content">
            <div>
                <div class="mobile-price"><span id="mobileTotalPrice">0.00</span> TND</div>
                <div class="mobile-protein"> <strong id="mobileTotalProtein">0</strong>g Protein</div>
            </div>
            <button class="mobile-cta" onclick="scrollToSummary()" data-translate="viewMeal">View Meal</button>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // Translation System
        let currentLanguage = 'ar';
        
        const translations = {
            en: {
                headerSubtitle: "Premium Protein House - Build Your Perfect Meal",
                quickMeals: "Quick Select Meals",
                mealScalope: "Escalope Meal",
                mealScalopeDesc: "Rice + Escalope + Salad",
                mealProteinOverdose: "Protein Overdose",
                mealProteinOverdoseDesc: "Escalope + Cuisse + Egg + Omelette + Salad",
                mealBalanced: "Balanced Meal",
                buildOwn: "Cook Your Own Meal",
                proteins: "Proteins",
                carbs: "Carbs",
                salads: "Salads",
                escalope: "Escalope",
                cuisse: "Chicken Thigh",
                eggs: "Eggs",
                omelette: "Omelette",
                rice: "Rice",
                borghol: "Borghol",
                normalSalad: "Normal Salad",
                saladeSautee: "Sauted Salad",
                perUnit: "per unit",
                piece: "piece",
                perPortion: "per portion",
                protein: "Protein",
                carbs: "Carbs",
                calories: "Calories",
                price: "Price",
                proteinLabel: "Protein",
                carbsLabel: "Carbs",
                caloriesLabel: "Calories",
                priceLabel: "Price",
                totalPrice: "Total Price",
                itemsInMeal: "items in your meal",
                nutritionalDetails: "Nutritional Details",
                carbohydrates: "Carbohydrates",
                fats: "Fats",
                fiber: "Fiber (from fruit)",
                numberOfMeals: "Number of Meals",
                buyNow: "Buy Now",
                saveMeal: "Save Meal",
                clearAll: "Clear All",
                freeFruit: "Free Daily Surprise Fruit",
                freeFruitDesc: "Every meal comes with a complimentary fresh fruit of the day!",
                todaySurprise: "Today's Surprise: Apple",
                surpriseFruit: "Surprise Fruit",
                dailyFree: "Daily free gift",
                fruitNutrition: "(Approx: 15g Carbs, 80 kcal, Rich in Fiber & Vitamin C)",
                powerBowl: "Power Bowl",
                leanClean: "Lean & Clean",
                highProtein: "HIGH PROTEIN",
                balanced: "BALANCED",
                processing: "Processing...",
                viewMeal: "View Meal",
                maxCarbsAlert: "Maximum 3 carb units allowed per meal!",
                minProteinAlert: "At least 1 protein unit required in your meal!",
                addIngredientsAlert: "Please add ingredients to your meal!",
                addProteinAlert: "Please add at least 1 protein to your meal!",
                mealAddedTitle: "Meal Added!",
                mealAddedMessage: "Your meal has been successfully added to the basket.",
                continueShopping: "Continue Shopping",
                viewBasket: "View Basket",
                confirmOrder: "Confirm your order?",
                clearMealConfirm: "Are you sure you want to clear your meal?",
                mealSavedTitle: "Meal Saved Successfully!",
                mealSavedDesc: "Your meal has been saved!",
                eggs3: "3 eggs",
                customerInfo: "Customer Information",
                yourName: "Your Name",
                yourPhone: "Your Phone Number",
                confirmOrder2: "Confirm Order",
                cancel: "Cancel",
                phoneError: "Phone number must be exactly 8 digits",
                cart: "Cart",
                basket: "Your Basket",
                addToCart: "Add to Basket",
                buyNow: "Buy Now",
                buyAll: "Buy All",
                emptyCart: "Your basket is empty",
                remove: "",
                total: "Total:",
                mealSelected: "selected! Scroll down to modify or add to basket."
            },
            fr: {
                headerSubtitle: "Maison Premium de Protines - Crez Votre Repas Parfait",
                quickMeals: "Repas Rapides",
                mealScalope: "Repas Escalope",
                mealScalopeDesc: "Riz + Escalope + Salade",
                mealProteinOverdose: "Surcharge Protine",
                mealProteinOverdoseDesc: "Escalope + Cuisse + uf + Omelette + Salade",
                mealBalanced: "Repas quilibr",
                buildOwn: "Cuisinez Votre Propre Repas",
                proteins: "Protines",
                carbs: "Glucides",
                salads: "Salades",
                escalope: "Escalope",
                cuisse: "Cuisse de Poulet",
                eggs: "ufs",
                omelette: "Omelette",
                rice: "Riz",
                borghol: "Borghol",
                normalSalad: "Salade Normale",
                saladeSautee: "Salade Saute",
                perUnit: "par unit",
                piece: "pice",
                perPortion: "par portion",
                protein: "Protine",
                carbs: "Glucides",
                calories: "Calories",
                price: "Prix",
                proteinLabel: "Protine",
                carbsLabel: "Glucides",
                caloriesLabel: "Calories",
                priceLabel: "Prix",
                totalPrice: "Prix Total",
                itemsInMeal: "articles dans votre repas",
                nutritionalDetails: "Dtails Nutritionnels",
                carbohydrates: "Glucides",
                fats: "Lipides",
                fiber: "Fibres (des fruits)",
                numberOfMeals: "Nombre de Repas",
                buyNow: "Acheter",
                saveMeal: "Sauvegarder",
                clearAll: "Tout Effacer",
                freeFruit: "Fruit Surprise Quotidien Gratuit",
                freeFruitDesc: "Chaque repas comprend un fruit frais du jour gratuit!",
                todaySurprise: "Surprise d'aujourd'hui: Pomme",
                surpriseFruit: "Fruit Surprise",
                dailyFree: "Cadeau gratuit quotidien",
                fruitNutrition: "(Environ: 15g Glucides, 80 kcal, Riche en Fibres et Vitamine C)",
                powerBowl: "Bol Puissance",
                leanClean: "Lger & Propre",
                highProtein: "HAUTE PROTINE",
                balanced: "QUILIBR",
                processing: "Traitement...",
                viewMeal: "Voir le Repas",
                maxCarbsAlert: "Maximum 3 units de glucides autorises par repas!",
                minProteinAlert: "Au moins 1 unit de protine requise dans votre repas!",
                addIngredientsAlert: "Veuillez ajouter des ingrdients  votre repas!",
                addProteinAlert: "Veuillez ajouter au moins 1 protine  votre repas!",
                mealAddedTitle: "Repas Ajout!",
                mealAddedMessage: "Votre repas a t ajout au panier avec succs.",
                continueShopping: "Continuer les Achats",
                viewBasket: "Voir le Panier",
                confirmOrder: "Confirmer votre commande?",
                clearMealConfirm: "tes-vous sr de vouloir effacer votre repas?",
                mealSavedTitle: "Repas Sauvegard avec Succs!",
                mealSavedDesc: "Votre repas a t sauvegard!",
                eggs3: "3 ufs",
                customerInfo: "Informations Client",
                yourName: "Votre Nom",
                yourPhone: "Votre Numro de Tlphone",
                confirmOrder2: "Confirmer la Commande",
                cancel: "Annuler",
                phoneError: "Le numro de tlphone doit contenir exactement 8 chiffres",
                cart: "Panier",
                basket: "Votre Panier",
                addToCart: "Ajouter au Panier",
                buyNow: "Acheter Maintenant",
                buyAll: "Tout Acheter",
                emptyCart: "Votre panier est vide",
                remove: "",
                total: "Total:",
                mealSelected: "slectionn! Faites dfiler pour modifier ou ajouter au panier."
            },
            ar: {
                headerSubtitle: "   -   ",
                quickMeals: " ",
                mealScalope: " ",
                mealScalopeDesc: " +  + ",
                mealProteinOverdose: "  ",
                mealProteinOverdoseDesc: " +  +  +  + ",
                mealBalanced: " ",
                buildOwn: "  ",
                proteins: "",
                carbs: "",
                salads: "",
                escalope: "",
                cuisse: " ",
                eggs: "",
                omelette: "",
                rice: "",
                borghol: "",
                normalSalad: " ",
                saladeSautee: " ",
                perUnit: " ",
                piece: "",
                perPortion: " ",
                protein: "",
                carbs: "",
                calories: "",
                price: "",
                proteinLabel: "",
                carbsLabel: "",
                caloriesLabel: "",
                priceLabel: "",
                totalPrice: " ",
                itemsInMeal: "  ",
                nutritionalDetails: " ",
                carbohydrates: "",
                fats: "",
                fiber: " ( )",
                numberOfMeals: " ",
                buyNow: " ",
                saveMeal: " ",
                clearAll: " ",
                freeFruit: "   ",
                freeFruitDesc: "      !",
                todaySurprise: " : ",
                surpriseFruit: " ",
                dailyFree: "  ",
                fruitNutrition: "(: 15   80     C)",
                powerBowl: " ",
                leanClean: " ",
                highProtein: " ",
                balanced: "",
                processing: " ...",
                viewMeal: " ",
                maxCarbsAlert: "  3    !",
                minProteinAlert: "       !",
                addIngredientsAlert: "    !",
                addProteinAlert: "       !",
                mealAddedTitle: " !",
                mealAddedMessage: "     .",
                continueShopping: " ",
                viewBasket: " ",
                confirmOrder: " ",
                clearMealConfirm: "     ",
                mealSavedTitle: "   !",
                mealSavedDesc: "  !",
                eggs3: "3 ",
                customerInfo: " ",
                yourName: "",
                yourPhone: " ",
                confirmOrder2: " ",
                cancel: "",
                phoneError: "     8  ",
                cart: "",
                basket: "",
                addToCart: "  ",
                buyNow: " ",
                buyAll: " ",
                emptyCart: " ",
                remove: "",
                total: ":",
                mealSelected: " !       ."
            }
        };

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('preferredLanguage', lang);
            
            // Update active language button
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('lang-' + lang).classList.add('active');
            
            // Apply translations
            const t = translations[lang];
            
            // Update header subtitle if it exists
            const headerSubtitleEl = document.getElementById('header-subtitle');
            if (headerSubtitleEl) headerSubtitleEl.textContent = t.headerSubtitle;
            
            document.querySelector('[data-translate="quickMeals"]').textContent = ' ' + t.quickMeals;
            document.querySelector('[data-translate="buildOwn"]').textContent = ' ' + t.buildOwn;
            document.querySelector('[data-translate="proteins"]').textContent = ' ' + t.proteins;
            document.querySelector('[data-translate="carbs"]').textContent = ' ' + t.carbs;
            document.querySelector('[data-translate="salads"]').textContent = ' ' + t.salads;
            
            // Update meal summary
            document.querySelector('[data-translate="totalPrice"]').textContent = t.totalPrice;
            document.querySelector('[data-translate="protein"]').textContent = ' ' + t.protein;
            document.querySelector('[data-translate="calories"]').textContent = ' ' + t.calories;
            document.querySelector('[data-translate="nutritionalDetails"]').textContent = t.nutritionalDetails;
            document.querySelector('[data-translate="carbohydrates"]').textContent = t.carbohydrates;
            document.querySelector('[data-translate="fats"]').textContent = t.fats;
            document.querySelector('[data-translate="fiber"]').textContent = t.fiber;
            document.querySelector('[data-translate="numberOfMeals"]').textContent = t.numberOfMeals;
            
            // Update buttons
            document.querySelector('[data-translate="buyNow"]').innerHTML = ' ' + t.buyNow;
            document.querySelector('[data-translate="saveMeal"]').innerHTML = ' ' + t.saveMeal;
            document.querySelector('[data-translate="clearAll"]').innerHTML = ' ' + t.clearAll;
            document.querySelector('[data-translate="viewMeal"]').textContent = t.viewMeal;
            
            // Update free fruit section
            const freeFruitEl = document.querySelector('[data-translate="freeFruit"]');
            if (freeFruitEl) freeFruitEl.textContent = t.freeFruit;
            const surpriseFruitEl = document.querySelector('[data-translate="surpriseFruit"]');
            if (surpriseFruitEl) surpriseFruitEl.textContent = t.surpriseFruit;
            const dailyFreeEl = document.querySelector('[data-translate="dailyFree"]');
            if (dailyFreeEl) dailyFreeEl.textContent = t.dailyFree;
            
            // Update ingredient names (preserve info icons)
            const updateIngredientName = (selector, translatedName) => {
                const el = document.querySelector(selector);
                if (el) {
                    const infoIcon = el.querySelector('.info-icon');
                    if (infoIcon) {
                        el.innerHTML = translatedName + ' ' + infoIcon.outerHTML;
                    } else {
                        el.textContent = translatedName;
                    }
                }
            };
            
            updateIngredientName('[data-ingredient="escalope"]', t.escalope);
            updateIngredientName('[data-ingredient="cuisse"]', t.cuisse);
            updateIngredientName('[data-ingredient="eggs"]', t.eggs);
            updateIngredientName('[data-ingredient="omelette"]', t.omelette);
            updateIngredientName('[data-ingredient="rice"]', t.rice);
            updateIngredientName('[data-ingredient="borghol"]', t.borghol);
            updateIngredientName('[data-ingredient="normalSalad"]', t.normalSalad);
            
            // Update unit labels
            document.querySelectorAll('[data-translate="perUnit"]').forEach(el => el.textContent = t.perUnit);
            document.querySelectorAll('[data-translate="piece"]').forEach(el => el.textContent = t.piece);
            document.querySelectorAll('[data-translate="perPortion"]').forEach(el => el.textContent = t.perPortion);
            document.querySelectorAll('[data-translate="eggs3"]').forEach(el => el.textContent = t.eggs3);
            
            // Update nutrition labels
            document.querySelectorAll('[data-translate="proteinLabel"]').forEach(el => el.textContent = t.proteinLabel);
            document.querySelectorAll('[data-translate="carbsLabel"]').forEach(el => el.textContent = t.carbsLabel);
            document.querySelectorAll('[data-translate="caloriesLabel"]').forEach(el => el.textContent = t.caloriesLabel);
            document.querySelectorAll('[data-translate="priceLabel"]').forEach(el => el.textContent = t.priceLabel);
            
            // Update meal tags and titles
            const highProteinEl = document.querySelector('[data-translate="highProtein"]');
            if (highProteinEl) highProteinEl.textContent = t.highProtein;
            const balancedEl = document.querySelector('[data-translate="balanced"]');
            if (balancedEl) balancedEl.textContent = t.balanced;
            const powerBowlEl = document.querySelector('[data-translate="powerBowl"]');
            if (powerBowlEl) powerBowlEl.textContent = t.powerBowl;
            const leanCleanEl = document.querySelector('[data-translate="leanClean"]');
            if (leanCleanEl) leanCleanEl.textContent = t.leanClean;
            
            // Update quick meal names and descriptions
            const mealScalopeEl = document.querySelector('[data-translate="mealScalope"]');
            if (mealScalopeEl) mealScalopeEl.textContent = t.mealScalope;
            const mealScalopeDescEl = document.querySelector('[data-translate="mealScalopeDesc"]');
            if (mealScalopeDescEl) mealScalopeDescEl.textContent = t.mealScalopeDesc;
            const mealProteinOverdoseEl = document.querySelector('[data-translate="mealProteinOverdose"]');
            if (mealProteinOverdoseEl) mealProteinOverdoseEl.textContent = t.mealProteinOverdose;
            const mealProteinOverdoseDescEl = document.querySelector('[data-translate="mealProteinOverdoseDesc"]');
            if (mealProteinOverdoseDescEl) mealProteinOverdoseDescEl.textContent = t.mealProteinOverdoseDesc;
            const mealBalancedEl = document.querySelector('[data-translate="mealBalanced"]');
            if (mealBalancedEl) mealBalancedEl.textContent = t.mealBalanced;
            
            // Update customer info modal
            const customerInfoEl = document.querySelector('[data-translate="customerInfo"]');
            if (customerInfoEl) customerInfoEl.textContent = t.customerInfo;
            const yourNameEl = document.querySelector('[data-translate="yourName"]');
            if (yourNameEl) yourNameEl.textContent = t.yourName;
            const yourPhoneEl = document.querySelector('[data-translate="yourPhone"]');
            if (yourPhoneEl) yourPhoneEl.textContent = t.yourPhone;
            const confirmOrder2El = document.querySelector('[data-translate="confirmOrder2"]');
            if (confirmOrder2El) confirmOrder2El.textContent = t.confirmOrder2;
            const cancelEl = document.querySelector('[data-translate="cancel"]');
            if (cancelEl) cancelEl.textContent = t.cancel;
            const phoneErrorEl = document.querySelector('[data-translate="phoneError"]');
            if (phoneErrorEl) phoneErrorEl.textContent = t.phoneError;
            
            // Update cart translations
            const cartEl = document.querySelector('[data-translate="cart"]');
            if (cartEl) cartEl.textContent = t.cart;
            const addToCartEl = document.querySelector('[data-translate="addToCart"]');
            if (addToCartEl) addToCartEl.textContent = ' ' + t.addToCart;
            const buyAllEl = document.querySelector('[data-translate="buyAll"]');
            if (buyAllEl) buyAllEl.textContent = ' ' + t.buyAll;
            const emptyCartEl = document.querySelector('[data-translate="emptyCart"]');
            if (emptyCartEl) emptyCartEl.textContent = t.emptyCart;
            const totalEl = document.querySelector('[data-translate="total"]');
            if (totalEl) totalEl.textContent = t.total;
            const removeEls = document.querySelectorAll('[data-translate="remove"]');
            removeEls.forEach(el => el.textContent = t.remove);
            
            // Update item count
            updateItemCount();
            
            // Update cart display if cart exists
            if (cart.length > 0) {
                updateCartDisplay();
            }
            
            // Set text direction
            document.body.style.direction = lang === 'ar' ? 'rtl' : 'ltr';
        }

        const ingredients = {
            rice: { 
                qty: 0, 
                protein: 3, 
                carbs: 40, 
                fat: 0.5, 
                calories: 175, 
                price: 1.50,
                emoji: ''
            },
            borghol: { 
                qty: 0, 
                protein: 4, 
                carbs: 38, 
                fat: 0.8, 
                calories: 170, 
                price: 1.50,
                emoji: ''
            },
            scallop: { 
                qty: 0, 
                protein: 25, 
                carbs: 0, 
                fat: 2, 
                calories: 120, 
                price: 8.50,
                emoji: ''
            },
            cuisse: { 
                qty: 0, 
                protein: 18, 
                carbs: 0, 
                fat: 10, 
                calories: 160, 
                price: 3.50,
                emoji: ''
            },
            eggs: { 
                qty: 0, 
                protein: 6, 
                carbs: 1, 
                fat: 5, 
                calories: 70, 
                price: 0.80,
                emoji: ''
            },
            omelette: { 
                qty: 0, 
                protein: 15, 
                carbs: 2, 
                fat: 12, 
                calories: 180, 
                price: 2.50,
                emoji: ''
            },
            salad: { 
                qty: 0, 
                protein: 1, 
                carbs: 5, 
                fat: 0.5, 
                calories: 25, 
                price: 1.50,
                emoji: ''
            },
            frite: { 
                qty: 0, 
                protein: 2, 
                carbs: 8, 
                fat: 3, 
                calories: 65, 
                price: 1.50,
                emoji: ''
            }
        };

        function updateIngredient(type, change) {
            const newQty = Math.max(0, ingredients[type].qty + change);
            const t = translations[currentLanguage];
            
            // Validation: Max 3 carb units
            if ((type === 'rice' || type === 'borghol') && change > 0) {
                const totalCarbs = ingredients.rice.qty + ingredients.borghol.qty;
                if (totalCarbs >= 3) {
                    alert(' ' + t.maxCarbsAlert);
                    return;
                }
            }
            
            // Validation: Minimum 1 protein unit (prevent removing last protein)
            if ((type === 'scallop' || type === 'cuisse' || type === 'eggs' || type === 'omelette') && change < 0) {
                const totalProteins = ingredients.scallop.qty + ingredients.cuisse.qty + ingredients.eggs.qty + ingredients.omelette.qty;
                if (totalProteins === 1 && ingredients[type].qty === 1) {
                    alert(' ' + t.minProteinAlert);
                    return;
                }
            }
            
            ingredients[type].qty = newQty;
            
            // Update both desktop and mobile displays
            const desktopQty = document.getElementById(`qty-${type}`);
            const mobileQty = document.getElementById(`qty-mobile-${type}`);
            
            if (desktopQty) desktopQty.textContent = ingredients[type].qty;
            if (mobileQty) mobileQty.textContent = ingredients[type].qty;
            
            // Add color feedback to button
            if (change > 0) {
                event.target.classList.add('add-feedback');
                setTimeout(() => event.target.classList.remove('add-feedback'), 400);
            } else if (change < 0) {
                event.target.classList.add('remove-feedback');
                setTimeout(() => event.target.classList.remove('remove-feedback'), 400);
            }
            
            // Highlight the ingredient card for visual feedback
            const card = (desktopQty || mobileQty)?.closest('.ingredient-card');
            if (card) {
                card.classList.add('highlight');
                setTimeout(() => card.classList.remove('highlight'), 500);
            }
            
            updateTotals();
            animateMeal();
            updateItemCount();
            updateButtonStates();
        }

        function changeMealCount(change) {
            const mealCountInput = document.getElementById('mealCount');
            const currentValue = parseInt(mealCountInput.value) || 1;
            const newValue = Math.max(1, Math.min(7, currentValue + change));
            
            mealCountInput.value = newValue;
            document.getElementById('mealCountDisplay').textContent = newValue;
            
            // Update button states
            document.getElementById('mealCountDecrease').disabled = newValue <= 1;
            document.getElementById('mealCountIncrease').disabled = newValue >= 7;
            
            // Add visual feedback
            const btn = change > 0 ? document.getElementById('mealCountIncrease') : document.getElementById('mealCountDecrease');
            btn.classList.add('add-feedback');
            setTimeout(() => btn.classList.remove('add-feedback'), 300);
            
            updateTotals();
        }

        function updateTotals() {
            let totalProtein = 0;
            let totalCarbs = 15; // Including free fruit
            let totalFats = 0;
            let totalCalories = 80; // Including free fruit
            let totalPrice = 0;
            let totalWeight = 0;

            for (let key in ingredients) {
                const ing = ingredients[key];
                totalProtein += ing.protein * ing.qty;
                totalCarbs += ing.carbs * ing.qty;
                totalFats += ing.fat * ing.qty;
                totalCalories += ing.calories * ing.qty;
                totalPrice += ing.price * ing.qty;
                
                // Calculate weight
                if (key === 'rice' || key === 'borghol') totalWeight += 50 * ing.qty;
                else if (key === 'scallop') totalWeight += 100 * ing.qty;
                else if (key === 'cuisse') totalWeight += 150 * ing.qty;
                else if (key === 'eggs') totalWeight += 50 * ing.qty;
                else if (key === 'omelette') totalWeight += 150 * ing.qty;
                else if (key === 'salad' || key === 'frite') totalWeight += 100 * ing.qty;
            }

            // Price is per meal, not multiplied by quantity
            document.getElementById('totalProtein').textContent = totalProtein.toFixed(0);
            document.getElementById('totalCarbs').textContent = totalCarbs.toFixed(0);
            document.getElementById('totalFats').textContent = totalFats.toFixed(1);
            document.getElementById('totalCalories').textContent = totalCalories.toFixed(0);
            document.getElementById('totalPrice').textContent = totalPrice.toFixed(2);

            // Update mobile bar
            document.getElementById('mobileTotalPrice').textContent = totalPrice.toFixed(2);
            document.getElementById('mobileTotalProtein').textContent = totalProtein.toFixed(0);

            // Store for progress bars
            window.currentTotals = {
                protein: totalProtein,
                calories: totalCalories,
                weight: totalWeight
            };
        }

        function updateItemCount() {
            let totalItems = 0;
            for (let key in ingredients) {
                totalItems += ingredients[key].qty;
            }
            
            const t = translations[currentLanguage];
            const countElement = document.getElementById('itemsCount');
            countElement.innerHTML = `<strong>${totalItems}</strong> ${t.itemsInMeal}`;
        }

        function updateButtonStates() {
            const hasItems = Object.values(ingredients).some(ing => ing.qty > 0);
            const totalProteins = ingredients.scallop.qty + ingredients.cuisse.qty + ingredients.eggs.qty + ingredients.omelette.qty;
            const hasMinProtein = totalProteins >= 1;
            
            // Enable buttons only if meal has items AND at least 1 protein
            const canOrder = hasItems && hasMinProtein;
            const buyNowBtn = document.getElementById('buyNowBtn');
            const addToCartBtn = document.getElementById('addToCartBtn');
            
            if (buyNowBtn) buyNowBtn.disabled = !canOrder;
            if (addToCartBtn) addToCartBtn.disabled = !canOrder;
        }

        // Load cart from localStorage
        let cart = [];
        try {
            const savedCart = localStorage.getItem('cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
            }
        } catch (e) {
            console.error('Error loading cart:', e);
            cart = [];
        }
        
        // Function to navigate to basket page
        function goToBasket() {
            window.location.href = 'basket.html';
        }

        function addToCart() {
            const t = translations[currentLanguage];
            const totalProteins = ingredients.scallop.qty + ingredients.cuisse.qty + ingredients.eggs.qty + ingredients.omelette.qty;
            if (totalProteins === 0) {
                alert(' ' + t.addProteinAlert);
                return;
            }

            const mealCount = parseInt(document.getElementById('mealCount').value) || 1;
            const mealDescription = getMealDescription();
            const totalPrice = parseFloat(document.getElementById('totalPrice').textContent);
            const protein = document.getElementById('totalProtein').textContent;
            const calories = document.getElementById('totalCalories').textContent;
            const carbs = document.getElementById('totalCarbs').textContent;
            const fats = document.getElementById('totalFats').textContent;

            // Create meal object
            const meal = {
                id: Date.now(),
                description: mealDescription,
                ingredients: JSON.parse(JSON.stringify(ingredients)),
                quantity: mealCount,
                price: totalPrice,
                protein: protein,
                calories: calories,
                carbs: carbs,
                fats: fats
            };

            cart.push(meal);
            updateCartDisplay();
            clearMeal(true); // Skip confirmation when adding to cart
            
            // Show success message with styled modal
            showAddToCartModal();
        }

        function buyNow() {
            const t = translations[currentLanguage];
            const totalProteins = ingredients.scallop.qty + ingredients.cuisse.qty + ingredients.eggs.qty + ingredients.omelette.qty;
            if (totalProteins === 0) {
                alert(' ' + t.addProteinAlert);
                return;
            }

            // Open customer info modal directly for immediate purchase
            document.getElementById('customerInfoModal').classList.add('active');
            
            // Store that this is a direct purchase (not from cart)
            window.directPurchase = true;
        }

        function updateCartDisplay() {
            // Save cart to localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Update header basket count
            const headerBasketCount = document.getElementById('headerBasketCount');
            if (headerBasketCount) {
                headerBasketCount.textContent = cart.length;
            }
        }

        function updateCartItem(index, change) {
            if (index < 0 || index >= cart.length) return;
            
            cart[index].quantity = Math.max(1, Math.min(7, cart[index].quantity + change));
            updateCartDisplay();
        }

        function removeFromCart(index) {
            if (index < 0 || index >= cart.length) return;
            cart.splice(index, 1);
            updateCartDisplay();
        }

        function buyAllFromCart() {
            const t = translations[currentLanguage];
            if (cart.length === 0) {
                alert(t.addIngredientsAlert);
                return;
            }

            // Show customer info modal
            document.getElementById('customerInfoModal').classList.add('active');
            document.getElementById('customerName').focus();
        }

        function clearMeal(skipConfirm = false) {
            if (!Object.values(ingredients).some(ing => ing.qty > 0)) {
                return;
            }

            const t = translations[currentLanguage];
            
            // If skipConfirm is true, or user confirms, clear the meal
            if (skipConfirm || confirm(t.clearMealConfirm)) {
                for (let key in ingredients) {
                    ingredients[key].qty = 0;
                    const desktopQty = document.getElementById(`qty-${key}`);
                    const mobileQty = document.getElementById(`qty-mobile-${key}`);
                    if (desktopQty) desktopQty.textContent = 0;
                    if (mobileQty) mobileQty.textContent = 0;
                }
                updateTotals();
                animateMeal();
                updateItemCount();
                updateButtonStates();
            }
        }

        function updateProgressBars() {
            if (!window.currentTotals) return;

            // Protein progress (target: 100g for a complete meal)
            const proteinPercent = Math.min((window.currentTotals.protein / 100) * 100, 100);
            document.getElementById('proteinBar').style.width = proteinPercent + '%';
            document.getElementById('proteinPercent').textContent = Math.round(proteinPercent) + '%';

            // Calorie progress (target: 800 kcal for a complete meal)
            const caloriePercent = Math.min((window.currentTotals.calories / 800) * 100, 100);
            document.getElementById('calorieBar').style.width = caloriePercent + '%';
            document.getElementById('caloriePercent').textContent = Math.round(caloriePercent) + '%';

            // Weight progress (shows actual weight)
            const weightPercent = Math.min((window.currentTotals.weight / 500) * 100, 100);
            document.getElementById('weightBar').style.width = weightPercent + '%';
            document.getElementById('weightAmount').textContent = window.currentTotals.weight + 'g';
        }

        function scrollToSummary() {
            document.querySelector('.meal-summary').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function animateMeal() {
            updateMealIngredientsList();
        }

        function updateMealIngredientsList() {
            const listContainer = document.getElementById('mealIngredientsList');
            const t = translations[currentLanguage];
            
            // Check if meal is empty
            let isEmpty = true;
            for (let key in ingredients) {
                if (ingredients[key].qty > 0) {
                    isEmpty = false;
                    break;
                }
            }

            // Show placeholder if empty
            if (isEmpty) {
                listContainer.innerHTML = `
                    <div class="empty-meal-list">
                        <div class="empty-meal-list-icon"></div>
                        <p>No ingredients added yet</p>
                    </div>
                `;
                return;
            }

            // Build ingredient list
            const ingredientNames = {
                rice: 'Rice',
                borghol: 'Borghol',
                scallop: 'Escalope',
                cuisse: 'Cuisse',
                eggs: 'Egg',
                omelette: 'Omelette',
                salad: 'Salad',
                frite: 'Frite'
            };

            const ingredientImages = {
                rice: 'rice.jpeg',
                borghol: 'borghol.jpg',
                scallop: 'escalope.jpg',
                cuisse: 'cuisse.jpeg',
                eggs: 'egg.jpeg',
                omelette: 'omelette.jpeg',
                salad: 'salade.jpg',
                frite: 'cuissed.jpeg'
            };

            const ingredientWeights = {
                rice: '50g',
                borghol: '50g',
                scallop: '100g',
                cuisse: '150g',
                eggs: '50g',
                omelette: '150g',
                salad: '100g',
                frite: '100g'
            };

            let html = '<h3>Your Ingredients</h3>';
            
            const order = ['rice', 'borghol', 'scallop', 'cuisse', 'eggs', 'omelette', 'salad', 'frite'];
            
            for (let key of order) {
                const ing = ingredients[key];
                if (ing.qty > 0) {
                    html += `
                        <div class="meal-ingredient-item">
                            <img src="${ingredientImages[key]}" alt="${ingredientNames[key]}">
                            <div class="meal-ingredient-info">
                                <div class="meal-ingredient-name">${ingredientNames[key]}</div>
                                <div class="meal-ingredient-details">${ingredientWeights[key]} per unit  ${ing.price.toFixed(2)} TND each</div>
                            </div>
                            <div class="meal-ingredient-quantity">${ing.qty}</div>
                        </div>
                    `;
                }
            }

            // Add free fruit
            html += `
                <div class="meal-ingredient-item" style="opacity: 0.8; background: #f5f5f5; border-radius: 8px;">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ctext x='50%25' y='50%25' font-size='30' text-anchor='middle' dy='.35em'%3E%3C/text%3E%3C/svg%3E" alt="Free Fruit">
                    <div class="meal-ingredient-info">
                        <div class="meal-ingredient-name">Fresh Fruit <span style="color: #000; font-size: 0.85em;">FREE</span></div>
                        <div class="meal-ingredient-details">Included with every meal</div>
                    </div>
                    <div class="meal-ingredient-quantity">1</div>
                </div>
            `;
            
            listContainer.innerHTML = html;
        }

        function selectQuickMeal(type) {
            // Reset all
            for (let key in ingredients) {
                ingredients[key].qty = 0;
                const qtyElement = document.getElementById(`qty-${key}`);
                if (qtyElement) qtyElement.textContent = 0;
            }

            if (type === 'scalope') {
                // 100g rice (2 units) + 100g escalope (1 unit) + 1 salad
                ingredients.rice.qty = 2;
                ingredients.scallop.qty = 1;
                ingredients.salad.qty = 1;
            } else if (type === 'proteinOverdose') {
                // 100g escalope (1 unit) + 1 cuisse + 1 egg + 1 omelette + 1 salad
                ingredients.scallop.qty = 1;
                ingredients.cuisse.qty = 1;
                ingredients.eggs.qty = 1;
                ingredients.omelette.qty = 1;
                ingredients.salad.qty = 1;
            }

            // Update display and highlight selected ingredients
            for (let key in ingredients) {
                const desktopQty = document.getElementById(`qty-${key}`);
                const mobileQty = document.getElementById(`qty-mobile-${key}`);
                
                if (desktopQty) desktopQty.textContent = ingredients[key].qty;
                if (mobileQty) mobileQty.textContent = ingredients[key].qty;
                
                // Highlight selected ingredients
                if (ingredients[key].qty > 0) {
                    const card = (desktopQty || mobileQty)?.closest('.ingredient-card');
                    if (card) {
                        card.classList.add('highlight');
                        setTimeout(() => card.classList.remove('highlight'), 2000);
                    }
                }
            }

            updateTotals();
            animateMeal();
            updateItemCount();
            updateButtonStates();

            // Scroll to ingredients section to show what was selected
            setTimeout(() => {
                const ingredientsSection = document.querySelector('.ingredients-section');
                if (ingredientsSection) {
                    ingredientsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);

            // Show a visual feedback message
            const t = translations[currentLanguage];
            const mealNames = {
                'scalope': t.mealScalope || 'Escalope Meal',
                'proteinOverdose': t.mealProteinOverdose || 'Protein Overdose'
            };
            
            // Show toast notification
            showToast(` ${mealNames[type]} ${t.mealSelected}`);
        }

        function selectDefaultMeal(type) {
            // Reset all
            for (let key in ingredients) {
                ingredients[key].qty = 0;
                const desktopQty = document.getElementById(`qty-${key}`);
                const mobileQty = document.getElementById(`qty-mobile-${key}`);
                if (desktopQty) desktopQty.textContent = 0;
                if (mobileQty) mobileQty.textContent = 0;
            }

            if (type === 'power') {
                ingredients.rice.qty = 3;
                ingredients.scallop.qty = 2;
                ingredients.cuisse.qty = 2;
                ingredients.salad.qty = 1;
            } else if (type === 'lean') {
                ingredients.rice.qty = 2;
                ingredients.scallop.qty = 1;
                ingredients.eggs.qty = 3;
                ingredients.salad.qty = 2;
            }

            for (let key in ingredients) {
                const desktopQty = document.getElementById(`qty-${key}`);
                const mobileQty = document.getElementById(`qty-mobile-${key}`);
                if (desktopQty) desktopQty.textContent = ingredients[key].qty;
                if (mobileQty) mobileQty.textContent = ingredients[key].qty;
            }

            updateTotals();
            animateMeal();
            updateItemCount();
            updateButtonStates();

            // Scroll to summary on mobile
            if (window.innerWidth < 1200) {
                setTimeout(() => {
                    document.querySelector('.meal-summary').scrollIntoView({ behavior: 'smooth' });
                }, 300);
            }
        }

        function getMealDescription() {
            let items = [];
            for (let key in ingredients) {
                if (ingredients[key].qty > 0) {
                    items.push(`${key}: ${ingredients[key].qty}`);
                }
            }
            return items.join(', ');
        }

        function closeCustomerModal() {
            document.getElementById('customerInfoModal').classList.remove('active');
            document.getElementById('customerForm').reset();
            document.getElementById('phoneError').style.display = 'none';
            document.getElementById('customerPhone').style.borderColor = '#e0e0e0';
        }

        function validatePhone(input) {
            const phone = input.value.replace(/\D/g, ''); // Remove non-digits
            input.value = phone; // Update input with only digits
            
            const errorEl = document.getElementById('phoneError');
            const t = translations[currentLanguage];
            
            if (phone.length === 8) {
                errorEl.style.display = 'none';
                input.style.borderColor = '#000';
            } else if (phone.length > 0) {
                errorEl.style.display = 'block';
                errorEl.textContent = t.phoneError;
                input.style.borderColor = '#666';
            } else {
                errorEl.style.display = 'none';
                input.style.borderColor = '#e0e0e0';
            }
        }

        function toggleNutrition(icon) {
            const card = icon.closest('.ingredient-card');
            const nutritionSection = card.querySelector('.ingredient-nutrition-compact');
            nutritionSection.classList.toggle('show');
        }

        function setDailySurpriseFruit() {
            const fruits = ['', '', '', '', '', '', ''];
            const dayOfWeek = new Date().getDay(); // 0 = Sunday, 1 = Monday, etc.
            const fruitIcon = document.getElementById('surpriseFruitIcon');
            if (fruitIcon) {
                fruitIcon.textContent = fruits[dayOfWeek];
            }
        }

        function submitOrder(event) {
            event.preventDefault();
            
            const t = translations[currentLanguage];
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.replace(/\D/g, '');
            const phoneErrorEl = document.getElementById('phoneError');
            
            // Validate phone number
            if (customerPhone.length !== 8) {
                phoneErrorEl.style.display = 'block';
                phoneErrorEl.textContent = t.phoneError;
                document.getElementById('customerPhone').style.borderColor = '#666';
                document.getElementById('customerPhone').focus();
                return;
            }

            // Close modal
            closeCustomerModal();

            // Calculate totals from cart or current meal (for direct purchase)
            let totalPrice = 0;
            let totalProtein = 0;
            let totalCalories = 0;
            let totalCarbs = 0;
            let totalFats = 0;
            let mealsList = [];

            if (window.directPurchase) {
                // Direct purchase - use current meal
                const mealDescription = getMealDescription();
                totalPrice = parseFloat(document.getElementById('totalPrice').textContent);
                totalProtein = parseFloat(document.getElementById('totalProtein').textContent);
                totalCalories = parseFloat(document.getElementById('totalCalories').textContent);
                totalCarbs = parseFloat(document.getElementById('totalCarbs').textContent);
                totalFats = parseFloat(document.getElementById('totalFats').textContent);
                mealsList.push(`Meal 1: ${mealDescription} (Qty: 1)`);
                
                // Clear the direct purchase flag
                window.directPurchase = false;
                
                // Clear the current meal (skip confirmation since order is confirmed)
                clearMeal(true);
            } else {
                // Purchase from cart
                cart.forEach((item, index) => {
                    totalPrice += item.price * item.quantity;
                    totalProtein += parseFloat(item.protein) * item.quantity;
                    totalCalories += parseFloat(item.calories) * item.quantity;
                    totalCarbs += parseFloat(item.carbs) * item.quantity;
                    totalFats += parseFloat(item.fats) * item.quantity;
                    mealsList.push(`Meal ${index + 1}: ${item.description} (Qty: ${item.quantity})`);
                });
                
                // Clear cart after submission
                cart = [];
                updateCartDisplay();
            }

            // Create form for Basin
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = 'https://usebasin.com/f/b06e024d33ee';
            form.style.display = 'none';

            const fields = {
                'customer_name': customerName,
                'customer_phone': customerPhone,
                'meals': mealsList.join(' | '),
                'total_items': cart.length,
                'total_price': totalPrice.toFixed(2) + ' TND',
                'total_protein': totalProtein.toFixed(0) + 'g',
                'total_calories': totalCalories.toFixed(0) + ' kcal',
                'total_carbs': totalCarbs.toFixed(0) + 'g',
                'total_fats': totalFats.toFixed(1) + 'g'
            };

            for (let key in fields) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = fields[key];
                form.appendChild(input);
            }

            document.body.appendChild(form);
            form.submit();
        }

        function saveMeal() {
            const t = translations[currentLanguage];
            const totalPrice = document.getElementById('totalPrice').textContent;
            
            if (parseFloat(totalPrice) === 0) {
                alert(t.addIngredientsAlert);
                return;
            }

            // Validation: Check minimum protein requirement
            const totalProteins = ingredients.scallop.qty + ingredients.cuisse.qty + ingredients.eggs.qty + ingredients.omelette.qty;
            if (totalProteins === 0) {
                alert(' ' + t.addProteinAlert);
                return;
            }

            const mealDescription = getMealDescription();
            const mealData = {
                ingredients: JSON.parse(JSON.stringify(ingredients)),
                mealCount: document.getElementById('mealCount').value,
                timestamp: new Date().toISOString()
            };

            try {
                localStorage.setItem('savedMeal_' + Date.now(), JSON.stringify(mealData));
                showModal(' ' + t.mealSavedTitle, `${t.mealSavedDesc}<br><br>${mealDescription}<br>${t.totalPrice}: ${totalPrice} TND`);
            } catch (e) {
                alert('Failed to save meal. Please try again.');
            }
        }

        function showModal(title, message) {
            document.getElementById('modalMessage').innerHTML = `<strong>${title}</strong><br>${message}`;
            document.getElementById('successModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('successModal').classList.remove('active');
        }

        function showAddToCartModal() {
            const t = translations[currentLanguage];
            const modal = document.getElementById('successModal');
            const modalContent = modal.querySelector('.modal-content');
            
            // Create custom content for add to cart
            modalContent.innerHTML = `
                <h2> ${t.mealAddedTitle || 'Meal Added!'}</h2>
                <p>${t.mealAddedMessage || 'Your meal has been successfully added to the basket.'}</p>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-secondary" style="flex: 1;" onclick="closeModal()">${t.continueShopping || 'Continue Shopping'}</button>
                    <button class="btn btn-primary" style="flex: 1;" onclick="window.location.href='basket.html'">${t.viewBasket || 'View Basket'}</button>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            if (!toast) return;
            
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        // Initialize
        updateTotals();
        animateMeal();
        updateItemCount();
        updateButtonStates();
        setDailySurpriseFruit();
        
        // Initialize meal count buttons
        const mealCount = parseInt(document.getElementById('mealCount').value) || 1;
        document.getElementById('mealCountDecrease').disabled = mealCount <= 1;
        document.getElementById('mealCountIncrease').disabled = mealCount >= 7;


        // Load saved language preference or default to Arabic
        const savedLang = localStorage.getItem('preferredLanguage') || 'ar';
        changeLanguage(savedLang);
        
        // Initialize header basket count
        const headerBasketCount = document.getElementById('headerBasketCount');
        if (headerBasketCount) {
            headerBasketCount.textContent = cart.length;
        }

        // Sticky sidebar enhancement - add visual feedback when stuck
        const observeSticky = () => {
            const sidebar = document.querySelector('.meal-summary');
            if (!sidebar) return;

            const observer = new IntersectionObserver(
                ([entry]) => {
                    if (entry.intersectionRatio < 1) {
                        sidebar.classList.add('is-stuck');
                    } else {
                        sidebar.classList.remove('is-stuck');
                    }
                },
                { threshold: [1], rootMargin: '-20px 0px 0px 0px' }
            );

            observer.observe(sidebar);
        };

        // Call sticky observer on desktop only
        if (window.innerWidth > 1200) {
            observeSticky();
        }
    </script>
</body>
</html>

